{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Customer Report{% endblock %}
{% block content %}
<div class="text-center mb-3">
  {% if contractor_logo_url %}
  <img src="{{ contractor_logo_url }}" alt="Contractor logo thumbnail" class="img-fluid mb-2" style="max-height:100px;">
  {% endif %}
  <h2>{{ contractor.name|default:contractor.email }}</h2>
</div>
<h1 class="text-center">Summary of Work - {{ project.name }}</h1>
{% if not report %}
<a href="?export=pdf" class="btn btn-secondary mb-3 d-print-none">Download PDF</a>
{% endif %}
<div class="table-responsive">
    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th style="text-align:left;">Date</th>
                {% if show_description %}<th style="text-align:left;">Description</th>{% endif %}
                {% if show_asset %}<th style="text-align:left;">Asset</th>{% endif %}
                {% if show_employee %}<th style="text-align:left;">Employee</th>{% endif %}
                {% if show_material %}<th style="text-align:left;">Material</th>{% endif %}
                <th style="text-align:right;">Hours</th>
                <th style="text-align:right;">Billable Amount</th>
            </tr>
        </thead>
        <tbody>
        {% for e in entries %}
            <tr>
                <td style="text-align:left;">{{ e.date }}</td>
                {% if show_description %}<td style="text-align:left;">{{ e.description }}</td>{% endif %}
                {% if show_asset %}<td style="text-align:left;">{% if e.asset %}{{ e.asset.name }}{% endif %}</td>{% endif %}
                {% if show_employee %}<td style="text-align:left;">{% if e.employee %}{{ e.employee.name }}{% endif %}</td>{% endif %}
                {% if show_material %}<td style="text-align:left;">{{ e.material_description }}</td>{% endif %}
                <td style="text-align:right;">{{ e.hours }}</td>
                <td style="text-align:right;">${{ e.billable_amount }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="{{ total_columns }}">No job entries.</td></tr>
        {% endfor %}
        <tr>
            <td colspan="{{ colspan_before_total }}" style="text-align:right; font-weight:bold;">Total</td>
            <td style="text-align:right; font-weight:bold;">${{ total }}</td>
        </tr>
        </tbody>
    </table>
</div>

{% if payments %}
<h2>Payments</h2>
<div class="table-responsive">
    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th style="text-align:left;">Date</th>
                <th style="text-align:right;">Amount</th>
            </tr>
        </thead>
        <tbody>
        {% for p in payments %}
            <tr>
                <td style="text-align:left;">{{ p.date }}</td>
                <td style="text-align:right;">${{ p.amount }}</td>
            </tr>
        {% endfor %}
        <tr>
            <td style="text-align:right; font-weight:bold;">Total Payments</td>
            <td style="text-align:right; font-weight:bold;">${{ total_payments }}</td>
        </tr>
        </tbody>
    </table>
</div>
{% else %}
<p>No payments have been recorded.</p>
{% endif %}

<p><strong>Outstanding Balance: ${{ outstanding }}</strong></p>
{% endblock %}

